var j=Object.defineProperty;var J=(a,t,e)=>t in a?j(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var s=(a,t,e)=>(J(a,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const m of l.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&n(m)}).observe(document,{childList:!0,subtree:!0});function e(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerpolicy&&(l.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?l.credentials="include":o.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=e(o);fetch(o.href,l)}})();class K{dispatch(t,e){for(let n of t)switch(console.log("Dispatching "+n&&n.Name?n.Name:"?"),n.Name){case"Message":this.dispatchMessage(n.Data,e.navbar);break;case"LoginResponse":let o=n.Data;this.dispatchUserUpdate(o,e);break;case"ProfileUpdateResponse":let l=n.Data;this.dispatchProfileUpdateResponse(l,e);case"Token":let m=n.Data;this.dispatchToken(m,e.fetcher);break;case"NewPassResponse":let b=n.Data;this.dispatchNewPassResponse(b,e);break;case"FullPage":let C=n.Data;this.dispatchFullPageResponse(C,e);break;case"Comment":let k=n.Data;this.dispatchCommentUpdate(k,e);break;case"LogoutResponse":this.dispatchUserUpdate(void 0,e);break;case"FeedbackReport":let I=n.Data;this.dispatchFeedbackReport(I,e);break;case"AdminUsersReport":let P=n.Data;this.dispatchUsersReport(P,e);break}}dispatchToken(t,e){e.setToken(t.JWT)}dispatchMessage(t,e){e.message.updateMessage(t)}dispatchFullPageResponse(t,e){e.navbar.commentsWindow.populateNewComments(t)}dispatchCommentUpdate(t,e){e.navbar.commentsWindow.updateComment(t)}dispatchUserUpdate(t,e){e.state.loadProfile(t,!1)}dispatchProfileUpdateResponse(t,e){e.state.loadProfile(t,!0)}dispatchNewPassResponse(t,e){e.navbar.newPassWindow.parseNewPassResponse(t),this.dispatchMessage(t,e.navbar)}dispatchFeedbackReport(t,e){e.navbar.adminWindow.feedbackReport.update(t.Records)}dispatchUsersReport(t,e){e.navbar.adminWindow.usersReport.update(t)}}const Y="http://localhost:3000",Q="ca-auth-tok";class X{constructor(){s(this,"responses");s(this,"token");this.responses=[],this.token=""}async fetch(t,e,n,o){let l=Y+"/"+t,m=new Headers;m.set("Content-Type","application/json"),m.set(Q,this.token),await fetch(l,{method:e,mode:"cors",headers:m,body:JSON.stringify(n)}).then(b=>b.json()).then(b=>{this.responses=b}).catch(b=>{console.error("Error fetching from server!",b);let C={Success:!1,Text:"Error fetching from server!"},k=new CustomEvent("FrontEndError",{detail:C});document.dispatchEvent(k)}),o()}getAndClearResponses(){let t=this.responses;return this.responses=[],t}setToken(t){this.token=t}}var i;(a=>{function t(d,r){let c=o("input",r);return c.type=d,c}a.createInputElement=t;function e(d,r,...c){let u=o(d,r);for(let h of c)u.append(h);return u}a.createContainer=e;function n(d,r,c,u,h){let E=l("label",d,r);return a.createContainer(c,h,E,u)}a.createContainerWithLabel=n;function o(d,r,c){let u=document.createElement(d);if(c!==void 0)for(let h of Object.keys(c))u.style[h]=c[h];if(r!==void 0&&r!=="")if(Array.isArray(r))for(let h of r)u.classList.add(h);else u.classList.add(r);return u}a.el=o;function l(d,r,c,u){let h=a.el(d,c,u);return h.textContent=r||"",h}a.textEl=l;function m(d,r,c){return l("div",d,r,c)}a.div=m;function b(d,r,c){return l("button",d,r,c)}a.button=b;function C(d,r,c){return l("span",d,r,c)}a.span=C;function k(d,r,c,u,h){let E=l("td",d,u),w;r.tagName!="TD"?(w=o("td",h),w.append(r)):(w=r,h!=null&&(Array.isArray(h)?w.classList.add(...h):w.classList.add(h)));let N=o("tr",c);return N.append(E,w),N}a.tableRow=k;function I(d,r,c){let u=a.el("option",c);return u.textContent=d,u.value=r??d,u}a.option=I;function P(d,r,c,u){let h=[];r==null?h=d:d.length!=r.length?(console.error("Unmatched array lengths when creating select button!",r),r=d):h=r;let E=a.el("select",c);for(let w=0;w<d.length;w++){let N=a.option(d[w],h[w],u);E.append(N)}return E}a.select=P})(i||(i={}));const Z={cafeWindow:"cafe-window"};class R{constructor(t,e){s(this,"el");this.el=document.createElement("div"),Array.isArray(e)?this.el.classList.add(...e):e!=null&&this.el.classList.add(e),t!=null&&(this.el.id=t),this.el.classList.add(Z.cafeWindow)}show(){this.el.style.display="block"}hide(){this.el.style.display="none"}}const y={windowName:"cafe-login-window",inputSection:"cafe-window-input-section",inputField:"cafe-window-input-field",inputLabel:"cafe-window-input-label",button:"cafe-window-button"};class ee extends R{constructor(){super(y.windowName,"Login");s(this,"username");s(this,"password");s(this,"submitLoginButton");s(this,"forgotPasswordButton");this.username=i.createInputElement("text",y.inputField),this.password=i.createInputElement("password",y.inputField),this.submitLoginButton=i.button("Login",y.button),this.forgotPasswordButton=i.button("Forgot Password",y.button),this.submitLoginButton.addEventListener("click",this.submitLoginClicked.bind(this)),this.forgotPasswordButton.addEventListener("click",this.forgotPasswordClicked.bind(this)),this.el.append(i.createContainerWithLabel("Username",y.inputLabel,"div",this.username,y.inputSection),i.createContainerWithLabel("Password",y.inputLabel,"div",this.password,y.inputSection),this.submitLoginButton,this.forgotPasswordButton)}submitLoginClicked(){let e={Username:this.username.value,Password:this.password.value},n=new CustomEvent("login",{detail:e});document.dispatchEvent(n)}forgotPasswordClicked(){let e=new CustomEvent("StateChangeRequest",{detail:"forgotpassword"});document.dispatchEvent(e)}}const p={windowName:"cafe-register-window",inputSection:"cafe-window-input-section",inputField:"cafe-window-input-field",inputLabel:"cafe-window-input-label",button:"cafe-window-button"};class te extends R{constructor(){super(p.windowName,"Register");s(this,"username");s(this,"password");s(this,"rePassword");s(this,"email");s(this,"agreedToTerms");s(this,"submitRegister");this.username=i.createInputElement("text",p.inputField),this.password=i.createInputElement("password",p.inputField),this.rePassword=i.createInputElement("password",p.inputField),this.email=i.createInputElement("email",p.inputField),this.agreedToTerms=i.createInputElement("checkbox",p.inputField),this.submitRegister=i.button("Register",p.button),this.submitRegister.addEventListener("click",this.submitRegisterClicked.bind(this)),this.el.append(i.createContainerWithLabel("Username",p.inputLabel,"div",this.username,p.inputSection),i.createContainerWithLabel("Password",p.inputLabel,"div",this.password,p.inputSection),i.createContainerWithLabel("Retype Password",p.inputLabel,"div",this.rePassword,p.inputSection),i.createContainerWithLabel("Email",p.inputLabel,"div",this.email,p.inputSection),i.createContainerWithLabel("Agree to Terms",p.inputLabel,"div",this.agreedToTerms,p.inputSection),this.submitRegister)}submitRegisterClicked(){let e={Username:this.username.value,Password:this.password.value,RetypePassword:this.rePassword.value,Email:this.email.value,AgreedToTerms:this.agreedToTerms.checked},n=new CustomEvent("register",{detail:e});document.dispatchEvent(n)}}const _={windowName:"cafe-pw-reset-window",inputField:"cafe-window-input-field",inputLabel:"cafe-window-input-label",inputSection:"cafe-window-input-section"};class ie extends R{constructor(){super(_.windowName);s(this,"email");s(this,"submitPWResetRequestButton");this.email=i.createInputElement("email",_.inputField),this.submitPWResetRequestButton=i.button("Reset Password"),this.submitPWResetRequestButton.addEventListener("click",this.submitButtonClicked.bind(this)),this.el.append(i.createContainerWithLabel("Email",_.inputLabel,"div",this.email,_.inputSection),this.submitPWResetRequestButton)}submitButtonClicked(){let e={Email:this.email.value},n=new CustomEvent("pwResetReq",{detail:e});document.dispatchEvent(n);let o=new CustomEvent("StateChangeRequest",{detail:"newPassword"});document.dispatchEvent(o)}}const g={windowName:"cafe-new-password-window",inputSection:"cafe-window-input-section",inputField:"cafe-window-input-field",inputLabel:"cafe-window-input-label",button:"cafe-window-button"};class se extends R{constructor(){super(g.windowName,"NewPassword");s(this,"email");s(this,"code");s(this,"newPassword");s(this,"reNewPassword");s(this,"submitButton");this.email=i.createInputElement("email",g.inputField),this.code=i.createInputElement("text",g.inputField),this.newPassword=i.createInputElement("password",g.inputField),this.reNewPassword=i.createInputElement("password",g.inputField),this.submitButton=i.button("Submit new password",g.button),this.submitButton.addEventListener("click",this.submitButtonClicked.bind(this)),this.el.append(i.createContainerWithLabel("Email",g.inputLabel,"div",this.email,g.inputSection),i.createContainerWithLabel("Code",g.inputLabel,"div",this.code,g.inputSection),i.createContainerWithLabel("New password",g.inputLabel,"div",this.newPassword,g.inputSection),i.createContainerWithLabel("Retype password",g.inputLabel,"div",this.reNewPassword,g.inputSection),this.submitButton)}submitButtonClicked(){console.log("ðŸ‘¶ submit new pass clicked");let e=Number(this.code.value);if(!isNaN(e)){let n={Email:this.email.value,Code:e,Password:this.newPassword.value,RetypePassword:this.reNewPassword.value},o=new CustomEvent("newPassword",{detail:n});document.dispatchEvent(o)}}parseNewPassResponse(e){if(e.Success==!0){let n=new CustomEvent("StateChangeRequest",{detail:"login"});document.dispatchEvent(n)}}}class x{constructor(t,e="div"){s(this,"data");s(this,"el");s(this,"blocker");s(this,"listeners");this.data=t,this.el=i.el(e,void 0,{position:"relative",zIndex:"0"}),this.blocker=i.div(void 0,void 0,{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%",zIndex:"-1"}),this.el.append(this.blocker),this.listeners=[]}clickListen(t,e,n=!0){if(n)if(Array.isArray(e)){let o=[];for(let l of e)o.push(l.bind(this));e=o}else e=e.bind(this);if(Array.isArray(t))if(Array.isArray(e))for(let o of t)for(let l of e)o.addEventListener("click",l),this.listeners.push([o,l,"click"]);else for(let o of t)o.addEventListener("click",e),this.listeners.push([o,e,"click"]);else if(Array.isArray(e))for(let o of e)t.addEventListener("click",o),this.listeners.push([t,o,"click"]);else t.addEventListener("click",e),this.listeners.push([t,e,"click"])}disable(){this.blocker.style.backgroundColor="rgba(200,200,200,0.5)",this.blocker.style.zIndex="1"}enable(){}destroy(){for(let t of this.listeners){let[e,n,o]=t;e.removeEventListener(o,n)}this.el.remove()}}const T={message_class:"server-message",message_success_false:"server-message-success-false",message_success_true:"server-message-success-true"};class ne extends x{constructor(){super({Success:!0,Text:"Welcome"});s(this,"displayedText");this.displayedText=i.div(void 0,T.message_class),this.el.appendChild(this.displayedText),this.displayedText.classList.add(T.message_success_true),this.updateMessage(this.data)}updateMessage(e){e!=null&&(this.el.removeChild(this.displayedText),this.el.append(this.displayedText),e.Success?(this.displayedText.classList.remove(T.message_success_false),this.displayedText.classList.add(T.message_success_true)):(this.displayedText.classList.remove(T.message_success_true),this.displayedText.classList.add(T.message_success_false)),this.displayedText.textContent=e.Text,this.data=e)}clearMessage(){this.updateMessage({Success:!0,Text:""})}}class W{constructor(t){s(this,"el");s(this,"listeners");this.el=i.div(),t!=null&&(Array.isArray(t)?t.forEach(e=>{this.el.classList.add(e)}):this.el.classList.add(t)),this.listeners=[]}destroy(){for(let t of this.listeners){let[e,n,o]=t;e.removeEventListener(o,n)}this.el.remove()}clickListen(t,e,n=!0){if(n)if(Array.isArray(e)){let o=[];for(let l of e)o.push(l.bind(this));e=o}else e=e.bind(this);if(Array.isArray(t))if(Array.isArray(e))for(let o of t)for(let l of e)o.addEventListener("click",l),this.listeners.push([o,l,"click"]);else for(let o of t)o.addEventListener("click",e),this.listeners.push([o,e,"click"]);else if(Array.isArray(e))for(let o of e)t.addEventListener("click",o),this.listeners.push([t,o,"click"]);else t.addEventListener("click",e),this.listeners.push([t,e,"click"])}}class oe extends W{constructor(e){super();s(this,"email");s(this,"password");s(this,"newEmail");s(this,"changeButton");s(this,"submitButton");s(this,"passwordDiv");s(this,"emailDiv");this.email=i.div(),this.changeButton=i.button("Change email"),this.passwordDiv=i.div(void 0,void 0,{display:"none"});let n=i.textEl("label","Password");this.password=i.createInputElement("password"),this.passwordDiv.append(n,this.password),this.emailDiv=i.div(void 0,void 0,{display:"none"});let o=i.textEl("label","New Email");this.newEmail=i.createInputElement("text"),this.emailDiv.append(o,this.newEmail),this.submitButton=i.button("Submit",void 0,{display:"none"}),this.el.append(this.email,this.changeButton,this.passwordDiv,this.emailDiv,this.submitButton),this.update(e),this.clickListen(this.changeButton,this.changeButtonClicked,!0),this.clickListen(this.submitButton,this.submitButtonClicked,!0)}update(e){e!=null&&(this.email.textContent=e)}changeButtonClicked(){this.submitButton.style.display=="none"?(this.emailDiv.style.display="block",this.newEmail.value="",this.passwordDiv.style.display="block",this.password.value="",this.submitButton.style.display="block"):(this.emailDiv.style.display="none",this.passwordDiv.style.display="none",this.submitButton.style.display="none")}submitButtonClicked(){let e={NewEmail:this.newEmail.value,Password:this.password.value},n=new CustomEvent("changeEmail",{detail:e});document.dispatchEvent(n),this.changeButtonClicked()}}class ae extends W{constructor(e){super();s(this,"profileBlurb");s(this,"editProfileBlurbButton");s(this,"editProfileTextarea");s(this,"editProfileSubmitButton");s(this,"editProfileBlurbDiv");this.profileBlurb=i.div(),this.editProfileBlurbButton=i.button("Edit"),this.editProfileBlurbDiv=i.div(void 0,void 0,{display:"none"}),this.editProfileTextarea=i.el("textarea"),this.editProfileSubmitButton=i.button("Submit"),this.editProfileBlurbDiv.append(this.editProfileTextarea,this.editProfileSubmitButton),this.clickListen(this.editProfileBlurbButton,this.toggleProfileTextArea,!0),this.clickListen(this.editProfileSubmitButton,this.submitProfileEditClicked,!0),this.el.append(this.profileBlurb,this.editProfileBlurbButton,this.editProfileBlurbDiv),this.update(e)}submitProfileEditClicked(){let e={NewBlurb:this.editProfileTextarea.value},n=new CustomEvent("changeProfile",{detail:e});document.dispatchEvent(n),this.toggleProfileTextArea()}update(e){e!=null?this.profileBlurb.textContent=e:this.profileBlurb.textContent=""}toggleProfileTextArea(){this.profileBlurb.style.display=="none"?(this.editProfileBlurbDiv.style.display="none",this.profileBlurb.style.display="block"):(this.profileBlurb.style.display="none",this.editProfileBlurbDiv.style.display="block",this.editProfileTextarea.value=this.profileBlurb.textContent?this.profileBlurb.textContent:"")}}const B={profileRow:"profile-info-row"};class le extends x{constructor(e){super(e);s(this,"username");s(this,"createdOn");s(this,"domainsModerating");s(this,"isAdmin");s(this,"isDomainModerator");s(this,"isGlobalModerator");s(this,"emailSection");s(this,"profileBlurbSection");let n=i.div(void 0,B.profileRow),o=i.textEl("label","Username");this.username=i.div(),n.append(o,this.username);let l=i.div(void 0,B.profileRow),m=i.textEl("label","Email");this.emailSection=new oe,l.append(m,this.emailSection.el);let b=i.div(void 0,B.profileRow),C=i.textEl("label","About");this.profileBlurbSection=new ae,b.append(C,this.profileBlurbSection.el);let k=i.div(void 0,B.profileRow),I=i.textEl("label","Created On");this.createdOn=i.div(),k.append(I,this.createdOn);let P=i.div(void 0,B.profileRow),d=i.textEl("label","Domains Moderating");this.domainsModerating=i.div(),P.append(d,this.domainsModerating);let r=i.div(void 0,B.profileRow),c=i.textEl("label","isAdmin");this.isAdmin=i.div(),r.append(c,this.isAdmin);let u=i.div(void 0,B.profileRow),h=i.textEl("label","domain mod?");this.isDomainModerator=i.div(),u.append(h,this.isDomainModerator);let E=i.div(void 0,B.profileRow),w=i.textEl("label","global mod?");this.isGlobalModerator=i.div(),E.append(w,this.isGlobalModerator),this.el.append(n,l,b,k,P,r,u,E),this.updateProfile({LoggedInAs:e,Email:""})}updateProfile(e){e.LoggedInAs!=null?(this.data=e.LoggedInAs,this.username.textContent=this.data.Username,this.createdOn.textContent=new Date(this.data.CreatedOn).toLocaleDateString(),this.domainsModerating.textContent=this.data.DomainsModerating,this.isAdmin.textContent=this.data.IsAdmin?"yes":"no",this.isDomainModerator.textContent=this.data.DomainsModerating?this.data.DomainsModerating:"",this.isGlobalModerator.textContent=this.data.IsGlobalModerator?"yes":"no",this.emailSection.update(e.Email?e.Email:""),this.profileBlurbSection.update(this.data.ProfileBlurb)):(this.username.textContent="",this.createdOn.textContent="",this.domainsModerating.textContent="",this.isAdmin.textContent="",this.isDomainModerator.textContent="",this.isGlobalModerator.textContent="",this.emailSection.update(""),this.profileBlurbSection.update(""))}}class re extends R{constructor(){super("cafe-settings");s(this,"passwordResetButton");s(this,"ownProfile");let e=i.textEl("h2","About You");this.ownProfile=new le(void 0),this.passwordResetButton=i.button("Request password reset"),this.passwordResetButton.addEventListener("click",this.passwordResetClicked.bind(this)),this.el.append(e,this.ownProfile.el,this.passwordResetButton)}passwordResetClicked(){let e=new CustomEvent("StateChangeRequest",{detail:"forgotpassword"});document.dispatchEvent(e)}}const V={sortRow:"profile-info-row"};class de extends x{constructor(e){super(e);s(this,"sortBy");s(this,"viewHidden");s(this,"sortAscending");s(this,"sortBy_option1");s(this,"sortBy_option2");s(this,"sortBy_option3");s(this,"sortBy_option4");this.sortBy=i.el("select"),this.viewHidden=i.createInputElement("checkbox"),this.sortAscending=i.createInputElement("checkbox"),this.sortBy_option1=i.el("option"),this.sortBy_option2=i.el("option"),this.sortBy_option3=i.el("option"),this.sortBy_option4=i.el("option"),this.sortBy_option1.text="new",this.sortBy_option2.text="funny",this.sortBy_option3.text="factual",this.sortBy_option4.text="agree",this.sortBy.add(this.sortBy_option1),this.sortBy.add(this.sortBy_option2),this.sortBy.add(this.sortBy_option3),this.sortBy.add(this.sortBy_option4);let n=i.textEl("label","Sort by"),o=i.textEl("label","View hidden"),l=i.textEl("label","Sort by ascending"),m=i.div(void 0,V.sortRow),b=i.div(void 0,V.sortRow),C=i.div(void 0,V.sortRow);m.append(n,this.sortBy),b.append(o,this.viewHidden),C.append(l,this.sortAscending),this.el.append(m,b,C)}settingChange(){let e={viewHidden:this.viewHidden.checked,sortAscending:this.sortAscending.checked};e.sortBy=this.sortBy.value in["new","funny","factual","agree"]?this.sortBy.value:"new",e=e}}const q={textArea:"comment-reply-textarea",submit:"comment-reply-submit"};class $ extends W{constructor(e,n=!1){super();s(this,"openbutton");s(this,"replyArea");s(this,"content");s(this,"submit");s(this,"repliesTo");s(this,"alwaysOpen");this.repliesTo=e,this.alwaysOpen=n,this.openbutton=i.button("Reply"),this.replyArea=i.div(),this.content=i.el("textarea",q.textArea,{display:"none"}),n?this.submit=i.button("Submit New Comment",q.submit):this.submit=i.button("Reply To Comment",q.submit,{display:"none"}),this.replyArea.append(this.content,this.submit),n?(this.el.append(this.replyArea),this.toggleReplyArea()):this.el.append(this.openbutton,this.replyArea),this.clickListen(this.openbutton,this.toggleReplyArea,!0),this.clickListen(this.submit,this.submitClicked,!0)}toggleReplyArea(){this.content.style.display=="none"?(this.content.style.display="block",this.alwaysOpen||(this.submit.style.display="block")):(this.content.style.display="none",this.alwaysOpen||(this.submit.style.display="none"))}submitClicked(){let e={ReplyingTo:this.repliesTo,Reply:this.content.value};this.content.value="";let n=new CustomEvent("newComment",{detail:e});document.dispatchEvent(n),this.alwaysOpen||this.toggleReplyArea()}}const H="/assets/arrow-f047fad3.svg",D={upvotebutton:"comment-vote-button",downvotebutton:"comment-vote-button",numberDisplay:"comment-vote-number-display",categoryDisplay:"comment-vote-category-display",voteContainer:"comment-vote-container"};class G extends x{constructor(e,n,o){super(o);s(this,"commentId");s(this,"voteType");s(this,"up");s(this,"down");s(this,"total");this.el.classList.add(D.voteContainer),this.commentId=n,this.voteType=e;let l=i.textEl("label",e,D.categoryDisplay);this.up=i.button("",D.upvotebutton,{backgroundImage:`url(${H})`,backgroundSize:"contain",transform:"rotate(180deg)"}),this.up.style.backgroundImage=`url(${H})`,this.down=i.button("",D.downvotebutton,{backgroundImage:`url(${H})`,backgroundSize:"contain"}),this.total=i.div(String(o.Ups+o.Downs),D.numberDisplay),this.el.append(this.up,l,this.total,this.down),this.clickListen(this.up,this.upVoteClicked,!0),this.clickListen(this.down,this.downVoteClicked,!0)}update(e){this.total.textContent=String(e.Ups+e.Downs)}upVoteClicked(){let e={VotingOn:this.commentId,VoteType:this.voteType,Value:1},n=new CustomEvent("voteComment",{detail:e});document.dispatchEvent(n)}downVoteClicked(){let e={VotingOn:this.commentId,VoteType:this.voteType,Value:-1},n=new CustomEvent("voteComment",{detail:e});document.dispatchEvent(n)}}class ce extends W{constructor(e){super();s(this,"funny");s(this,"factual");s(this,"agree");this.funny=new G("funny",e.CommentId,e.Funny),this.factual=new G("factual",e.CommentId,e.Factual),this.agree=new G("agree",e.CommentId,e.Agree),this.el.append(this.funny.el,this.factual.el,this.agree.el)}update(e){this.funny.update(e.Funny),this.factual.update(e.Factual),this.agree.update(e.Agree)}}const O={usernameHeader:"username-header",baseComment:"cafe-comment",childComments:"comment-child-container",content:"cafe-comment-content"};class he extends x{constructor(e){super(e);s(this,"username");s(this,"content");s(this,"replySection");s(this,"childContainer");s(this,"voteSection");this.el.classList.add(O.baseComment),this.username=i.el("div",O.usernameHeader),this.content=i.el("div",O.content),this.replySection=new $(e.CommentId),this.childContainer=i.div(void 0,O.childComments),this.username.textContent=e==null?"":e.Username,this.content.textContent=e==null?"":e.Content,this.voteSection=new ce(e),this.el.append(this.username,this.content,this.voteSection.el,this.replySection.el,this.childContainer)}reportButtonClicked(){let e=new CustomEvent("StateChangeRequest",{detail:"forgotpassword"});document.dispatchEvent(e)}update(e){this.voteSection.update(e)}addChild(e){this.childContainer.appendChild(e.el)}}const ue={commentContainer:"comments-container"};class pe extends R{constructor(){super();s(this,"data");s(this,"lastSettings");s(this,"displayedComments");s(this,"commentSortSettings");s(this,"newCommentSection");s(this,"pseudoURL");s(this,"commentContainer");s(this,"purlSubmit");this.data=[],this.displayedComments=new Map,this.commentSortSettings=new de,this.newCommentSection=new $(0,!0),this.commentContainer=i.div(void 0,ue.commentContainer);let e=i.div(),n=i.textEl("label","Pseudo URL");this.pseudoURL=i.createInputElement("url"),this.purlSubmit=i.button("ðŸŒŽ",void 0,{display:"inline"}),e=i.div(),e.append(n,this.pseudoURL,this.purlSubmit),this.purlSubmit.addEventListener("click",this.requestCommentsForPseudoURLPage.bind(this)),this.el.append(this.commentSortSettings.el,e,this.commentContainer,this.newCommentSection.el)}populateNewComments(e){for(this.data=e.Comments,this.displayedComments.clear();this.commentContainer.firstChild;)this.commentContainer.removeChild(this.commentContainer.firstChild);for(let n of this.data)this.updateComment(n)}updateComment(e){var o;let n=this.displayedComments.get(e.CommentId);if(n==null){let l=new he(e);this.displayedComments.set(e.CommentId,l),e.Parent!=0?(this.displayedComments.get(e.Parent),console.log("Comment does have parent"),(o=this.displayedComments.get(e.Parent))==null||o.addChild(l)):(console.log("Comment does not have parent"),this.commentContainer.appendChild(l.el))}else n.update(e)}requestCommentsForPseudoURLPage(){let e={Url:this.pseudoURL.value,SortedBy:this.commentSortSettings.data!=null?this.commentSortSettings.data.sortBy:"new",SortAscending:this.commentSortSettings.data!=null?this.commentSortSettings.data.sortAscending:!0},n=new CustomEvent("getComments",{detail:e});document.dispatchEvent(n)}resortComments(){this.data=[]}updateFromSettings(e){this.lastSettings=this.commentSortSettings.data,this.commentSortSettings.data=e,this.resortComments()}}class me extends x{constructor(e){super(e,"tr");s(this,"id");s(this,"submittedAt");s(this,"feedbackType");s(this,"userId");s(this,"username");s(this,"content");this.id=i.textEl("td",e.ID.toString());let n=new Date(e.SubmittedAt);this.submittedAt=i.textEl("td",n.toDateString()+" "+n.toTimeString()),this.feedbackType=i.textEl("td",e.FeedbackType),this.userId=i.textEl("td",e.UserID.toString()),this.username=i.textEl("td",e.Username),this.content=i.textEl("td",e.Content),this.el.append(this.id,this.submittedAt,this.feedbackType,this.userId,this.username,this.content)}}const M={sectionLabel:["section-label","section-label-as-button"],inputLabel:"section-input-label-medium"};class be extends W{constructor(){super();s(this,"from");s(this,"to");s(this,"feedbackType");s(this,"requestFeedbackButton");s(this,"dropDownContainer");s(this,"feedbacksTable");s(this,"activeFeedbacks");let e=i.div("Feedback Report",M.sectionLabel);this.dropDownContainer=i.div(),this.feedbacksTable=i.el("table"),this.activeFeedbacks=[];let n=i.div();this.from=i.createInputElement("datetime-local"),this.to=i.createInputElement("datetime-local"),this.feedbackType=i.select(["bug","feature","general","all"]),this.requestFeedbackButton=i.button("Request Feedback"),n.append(i.createContainerWithLabel("From:",M.inputLabel,"div",this.from),i.createContainerWithLabel("To:",M.inputLabel,"div",this.to),i.createContainerWithLabel("Type:",M.inputLabel,"div",this.feedbackType),this.requestFeedbackButton),this.dropDownContainer.append(n),this.el.append(e,this.dropDownContainer),this.clickListen(e,this.toggleFold,!0),this.clickListen(this.requestFeedbackButton,this.getFeedbackReportClicked,!0)}toggleFold(){this.dropDownContainer.style.display=="none"?this.dropDownContainer.style.display="block":this.dropDownContainer.style.display="none"}update(e){for(let n of this.activeFeedbacks)n.destroy(),n.el.remove();this.activeFeedbacks=[];for(let n of e){let o=new me(n);this.activeFeedbacks.push(o),this.feedbacksTable.append(o.el)}}getFeedbackReportClicked(){var o,l;let e={};e.From=(o=this.from.valueAsDate)==null?void 0:o.valueOf(),e.To=(l=this.to.valueAsDate)==null?void 0:l.valueOf(),e.FeedbackType=this.feedbackType;let n=new CustomEvent("viewFeedback",{detail:e});document.dispatchEvent(n)}}const v={labelContainer:"section-container-table",label:"section-container-table-td-label",tableData:"section-container-table-td-data",table:"section-container-table",sectionLabel:["section-label","section-label-as-button"]};class we extends W{constructor(){super();s(this,"data");s(this,"loggedInCount");s(this,"newestUserID");s(this,"newestUsername");s(this,"userCount");s(this,"lastReportContainer");s(this,"lastUpdate");s(this,"refreshButton");let e=i.div("Users Report",v.sectionLabel);this.lastReportContainer=i.div();let n=i.el("table",v.table);this.loggedInCount=i.el("td",v.tableData),this.newestUserID=i.el("td",v.tableData),this.newestUsername=i.el("td",v.tableData),this.userCount=i.el("td",v.tableData),this.lastUpdate=i.el("td",v.tableData),this.refreshButton=i.button("Get Users Report"),n.append(i.tableRow("Last Update: ",this.lastUpdate,void 0,v.label),i.tableRow("Logged in Count: ",this.loggedInCount,void 0,v.label),i.tableRow("Newest User ID: ",this.newestUserID,void 0,v.label),i.tableRow("Newest Username: ",this.newestUsername,void 0,v.label),i.tableRow("Total Users: ",this.userCount,void 0,v.label)),this.lastReportContainer.append(n,this.refreshButton),this.el.append(e,this.lastReportContainer),this.clickListen(e,this.toggleFold,!0),this.clickListen(this.refreshButton,this.getUsersReportClicked,!0)}update(e){let n=new Date;this.lastUpdate.textContent=n.toLocaleDateString()+" "+n.toLocaleTimeString(),this.loggedInCount.textContent=e.LoggedInUserCount.toString(),this.newestUserID.textContent=e.NewestUserId.toString(),this.newestUsername.textContent=e.NewestUsername,this.userCount.textContent=e.UserCount.toString()}toggleFold(){this.lastReportContainer.style.display=="none"?this.lastReportContainer.style.display="block":this.lastReportContainer.style.display="none"}getUsersReportClicked(){let e=new CustomEvent("viewUsersReport",{detail:{}});document.dispatchEvent(e)}}class ge extends R{constructor(){super();s(this,"usersReport");s(this,"feedbackReport");this.usersReport=new we,this.feedbackReport=new be,this.el.append(this.usersReport.el),this.el.append(this.feedbackReport.el)}}const f={cafe:"cafe-container",nav:"nav-bar",navTabButton:"nav-tab",activeNavTab:"active-nav-tab",logoutButton:"nav-tab-logout"};class ve{constructor(){s(this,"el");s(this,"message");s(this,"registerButton");s(this,"loginButton");s(this,"logoutButton");s(this,"settingsButton");s(this,"commentsButton");s(this,"adminButton");s(this,"currentlyViewing");s(this,"commentsWindow");s(this,"registerWindow");s(this,"loginWindow");s(this,"settingsWindow");s(this,"forgotPWWindow");s(this,"newPassWindow");s(this,"adminWindow");this.el=i.el("div",f.cafe);let t=i.el("nav",f.nav);this.message=new ne;let e=i.div();this.registerButton=i.button("Register",[f.navTabButton,f.activeNavTab]),this.loginButton=i.button("Login",[f.navTabButton]),this.settingsButton=i.button("Settings",[f.navTabButton]),this.logoutButton=i.button("Logout",[f.navTabButton,f.logoutButton]),this.commentsButton=i.button("Comments",[f.navTabButton]),this.adminButton=i.button("Admin",[f.navTabButton]),this.registerButton.addEventListener("click",F("register")),this.loginButton.addEventListener("click",F("login")),this.settingsButton.addEventListener("click",F("settings")),this.commentsButton.addEventListener("click",F("comments")),this.logoutButton.addEventListener("click",this.logoutButtonClicked.bind(this)),this.adminButton.addEventListener("click",F("admin")),this.settingsWindow=new re,this.forgotPWWindow=new ie,this.registerWindow=new te,this.loginWindow=new ee,this.newPassWindow=new se,this.commentsWindow=new pe,this.adminWindow=new ge,this.loginWindow.hide(),this.currentlyViewing=this.registerWindow,this.el.append(this.message.el,t,e),t.append(this.commentsButton,this.registerButton,this.loginButton,this.logoutButton,this.settingsButton,this.adminButton),e.append(this.registerWindow.el,this.loginWindow.el,this.settingsWindow.el,this.forgotPWWindow.el,this.newPassWindow.el,this.commentsWindow.el,this.adminWindow.el)}setFromState(t){switch(this.hideAll(),t.ownProfile!=null&&this.settingsWindow.ownProfile.updateProfile(t.ownProfile),t.ownProfile==null?this.showLoggedOutButtons():(this.showLoggedInButtons(),this.logoutButton.innerHTML="Logout "+t.ownProfile.LoggedInAs.Username),t.viewing){case"register":this.currentlyViewing=this.registerWindow,U(this.registerButton);break;case"login":this.currentlyViewing=this.loginWindow,U(this.loginButton);break;case"settings":this.currentlyViewing=this.settingsWindow,U(this.settingsButton);break;case"forgotpassword":this.currentlyViewing=this.forgotPWWindow,U(this.settingsButton);break;case"comments":this.currentlyViewing=this.commentsWindow,U(this.commentsButton);break;case"newPassword":this.currentlyViewing=this.newPassWindow;break;case"admin":this.currentlyViewing=this.adminWindow;break;default:this.currentlyViewing=void 0;break}this.currentlyViewing!=null&&this.currentlyViewing.show()}showLoggedOutButtons(){L(this.registerButton),L(this.loginButton),L(this.commentsButton),L(this.adminButton)}showLoggedInButtons(){L(this.logoutButton),L(this.settingsButton),L(this.commentsButton)}hideAll(){this.newPassWindow.hide(),this.forgotPWWindow.hide(),this.settingsWindow.hide(),this.registerWindow.hide(),this.loginWindow.hide(),this.settingsWindow.hide(),this.commentsWindow.hide(),this.adminWindow.hide(),A(this.registerButton),A(this.loginButton),A(this.logoutButton),A(this.settingsButton),A(this.commentsButton),A(this.adminButton)}logoutButtonClicked(){this.hideAll();let t={},e=new CustomEvent("logout",{detail:t});document.dispatchEvent(e)}}function F(a){return function(){let t=new CustomEvent("StateChangeRequest",{detail:a});document.dispatchEvent(t)}}function A(a){a.style.display="none",fe(a)}function L(a){a.style.display="inline-block"}function U(a){a.classList.add(f.activeNavTab)}function fe(a){a.classList.remove(f.activeNavTab)}class Ce{constructor(){s(this,"viewing");s(this,"ownProfile");this.viewing="register"}setViewingTo(t){switch(console.log("state change requested to ",t),t){case"register":this.ownProfile==null&&(this.viewing=t,S(t));break;case"login":this.ownProfile==null?(this.viewing=t,S(t)):(this.viewing="settings",S(this.viewing));break;case"none":this.ownProfile=void 0,this.viewing=t,S(t);break;case"forgotpassword":this.viewing=t,S(t);break;case"settings":this.viewing=t,S(t);break;default:this.viewing=t,S(t);break}}loadProfile(t,e){this.ownProfile=t,this.ownProfile&&e!=!0?this.viewing="none":this.ownProfile==null&&e!=!0&&(this.viewing="login"),S(this.viewing)}}function S(a){let t=new CustomEvent("StateChanged",{detail:a});document.dispatchEvent(t)}class Ee{constructor(){s(this,"fetcher");s(this,"state");s(this,"navbar");s(this,"dispatcher");s(this,"sortSettings");this.fetcher=new X,this.state=new Ce,this.navbar=new ve,this.dispatcher=new K,this.setClientEventListeners(),this.setStateEventListeners(),this.navbar.setFromState(this.state),this.sortSettings={viewHidden:!1,sortAscending:!0,sortBy:"new"}}setClientEventListeners(){let t=this,e=t.checkForResponses.bind(this);document.addEventListener("register",n=>{let o=n.detail;console.log("REGISTER EVENT RECEIVED WITH DATA: ",o),t.fetcher.fetch("register","POST",o,e)}),document.addEventListener("login",n=>{let o=n.detail;console.log("LOGIN EVENT RECEIVED WITH DATA: ",o),t.fetcher.fetch("login","POST",o,e)}),document.addEventListener("logout",n=>{let o=n.detail;console.log("LOGOUT EVENT RECEIVED WITH DATA: ",o),t.fetcher.fetch("logout","PUT",o,e)}),document.addEventListener("pwResetReq",n=>{let o=n.detail;console.log("FORGOT PASSWORD EVENT RECEIVED WITH DATA: ",o),t.fetcher.fetch("pwResetReq","POST",o,e)}),document.addEventListener("newPassword",n=>{let o=n.detail;console.log("SET NEW PASSWORD EVENT RECEIVED WITH DATA: ",o),t.fetcher.fetch("newPassword","POST",o,e)}),document.addEventListener("changeEmail",n=>{let o=n.detail;console.log("CHANGE EMAIL EVENT RECEIVED WITH DATA: ",o),t.fetcher.fetch("changeEmail","POST",o,e)}),document.addEventListener("changeProfile",n=>{let o=n.detail;console.log("CHANGE PROFILE BLURB EVENT RECEIVED WITH DATA: ",o),t.fetcher.fetch("changeProfile","POST",o,e)}),document.addEventListener("getComments",n=>{let o=n.detail;console.log("GET COMMENTS EVENT RECEIVED WITH DATA: ",o),t.fetcher.fetch("getComments","POST",o,e)}),document.addEventListener("newComment",n=>{let o=n.detail;console.log("NEW COMMENT EVENT RECEIVED WITH DATA: ",o),t.fetcher.fetch("newComment","POST",o,e)}),document.addEventListener("voteComment",n=>{let o=n.detail;console.log("NEW COMMENT EVENT RECEIVED WITH DATA: ",o),t.fetcher.fetch("voteComment","POST",o,e)}),document.addEventListener("viewUsersReport",n=>{let o=n.detail;console.log("NEW VIEW USERSREPORT EVENT RECEIVED WITH DATA: ",o),t.fetcher.fetch("viewUsersReport","POST",o,e)}),document.addEventListener("viewFeedback",n=>{let o=n.detail;console.log("NEW VIEW FEEDBACK EVENT RECEIVED WITH DATA: ",o),t.fetcher.fetch("viewFeedback","POST",o,e)}),document.addEventListener("FrontEndError",n=>{console.error("Front End Error!"),t.navbar.message.updateMessage(n.detail)})}setStateEventListeners(){let t=this;document.addEventListener("StateChangeRequest",e=>{t.state.setViewingTo(e.detail)}),document.addEventListener("StateChanged",()=>{console.log("state change event received",t.state),t.navbar.setFromState(t.state)})}checkForResponses(){let t=this.fetcher.getAndClearResponses();console.log("ðŸŽ…ðŸ¤¶ðŸ¤¶ All server responses:",t),this.dispatcher.dispatch(t,this)}}const z=new Ee;document.body.append(z.navbar.el);console.log("Comment Anywhere Front End running:",z);
